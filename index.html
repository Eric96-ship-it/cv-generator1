<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional CV Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.4;
            font-family: 'Times New Roman', Times, serif;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
        }

        /* Responsive header */
        header {
            background: linear-gradient(135deg, #2c3e50 0%, #4a6491 100%);
            color: white;
            padding: 1.2rem 0;
            text-align: center;
            margin-bottom: 1.5rem;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: clamp(1.5rem, 4vw, 2rem);
            margin-bottom: 0.3rem;
            padding: 0 1rem;
        }

        header p {
            font-size: clamp(0.9rem, 2.5vw, 1rem);
            opacity: 0.9;
            padding: 0 1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Main app container */
        .app-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-section, .preview-section {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 8px;
            padding: 1.2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        /* Responsive grids */
        .section-title {
            color: #2c3e50;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 0.4rem;
            margin-bottom: 1.2rem;
            font-size: clamp(1rem, 2vw, 1.2rem);
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 0.8rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.3rem;
            font-weight: 600;
            color: #444;
            font-size: clamp(0.8rem, 1.5vw, 0.9rem);
        }

        .form-control {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: clamp(0.85rem, 1.5vw, 0.9rem);
            transition: border 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #2c3e50;
            box-shadow: 0 0 0 2px rgba(44, 62, 80, 0.1);
        }

        /* Responsive grid for personal details */
        .personal-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.8rem;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: clamp(0.85rem, 1.5vw, 0.95rem);
            transition: all 0.3s;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(44, 62, 80, 0.2);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .btn-payment {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            width: 100%;
            margin-top: 1rem;
            font-size: clamp(0.9rem, 2vw, 1rem);
            padding: 0.9rem 2rem;
        }

        .add-btn, .remove-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: clamp(0.75rem, 1.5vw, 0.8rem);
            margin-top: 0.5rem;
            transition: background 0.3s;
        }

        .remove-btn {
            background: #e74c3c;
        }

        .add-btn:hover {
            background: #2980b9;
        }

        .remove-btn:hover {
            background: #c0392b;
        }

        /* Section items */
        .section-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 0.8rem;
            border-left: 4px solid #3498db;
        }

        /* Skills section */
        .skills-input {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .skills-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem;
            margin-top: 0.5rem;
        }

        .skill-tag {
            background: #e8f4fc;
            border: 1px solid #bce0fd;
            padding: 0.3rem 0.8rem;
            border-radius: 3px;
            font-size: clamp(0.75rem, 1.5vw, 0.8rem);
        }

        /* Preview section */
        .preview-container {
            flex: 1;
            background: white;
            border: 1px solid #ddd;
            padding: 1.5rem;
            overflow-y: auto;
            font-size: clamp(10px, 1.5vw, 12px);
            line-height: 1.5;
            overflow-x: hidden;
            word-wrap: break-word;
            border-radius: 5px;
            min-height: 300px;
        }

        /* CV Preview Styling */
        .cv-preview {
            font-family: 'Times New Roman', Times, serif;
            font-size: clamp(10px, 1.5vw, 12px);
            line-height: 1.5;
            color: #000;
            width: 100%;
            overflow-wrap: break-word;
        }

        .cv-header {
            text-align: center;
            margin-bottom: 0.8rem;
            border-bottom: 1px solid #000;
            padding-bottom: 0.3rem;
        }

        .cv-name {
            font-size: clamp(14px, 2.5vw, 18px);
            font-weight: bold;
            margin-bottom: 0.2rem;
        }

        .cv-title {
            font-size: clamp(12px, 2vw, 14px);
            font-weight: bold;
            margin-bottom: 0.2rem;
        }

        .cv-contact {
            font-size: clamp(10px, 1.5vw, 12px);
            color: #555;
            line-height: 1.3;
        }

        .cv-section {
            margin-bottom: 0.8rem;
            width: 100%;
        }

        .cv-section-title {
            font-size: clamp(12px, 2vw, 14px);
            font-weight: bold;
            text-transform: uppercase;
            border-bottom: 1px solid #000;
            padding-bottom: 0.2rem;
            margin-bottom: 0.5rem;
        }

        /* Work Experience */
        .cv-experience-item {
            margin-bottom: 0.8rem;
        }

        .cv-experience-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 0.2rem;
        }

        .cv-organization {
            font-weight: bold;
            font-size: clamp(11px, 1.8vw, 12px);
        }

        .cv-period {
            font-size: clamp(10px, 1.5vw, 12px);
            color: #555;
        }

        .cv-role {
            font-size: clamp(10px, 1.5vw, 12px);
            font-style: italic;
            margin-bottom: 0.2rem;
        }

        .cv-roles-title {
            font-size: clamp(11px, 1.8vw, 12px);
            font-weight: bold;
            text-decoration: underline;
            margin-bottom: 0.3rem;
        }

        .cv-responsibilities {
            font-size: clamp(10px, 1.5vw, 12px);
            margin-left: 0.5rem;
        }

        .cv-responsibilities ul {
            padding-left: 0.8rem;
            margin-top: 0.2rem;
        }

        /* Education */
        .cv-education-item {
            margin-bottom: 0.8rem;
        }

        .cv-education-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 0.2rem;
        }

        .cv-institution {
            font-weight: bold;
            font-size: clamp(11px, 1.8vw, 12px);
        }

        .cv-education-period {
            font-size: clamp(10px, 1.5vw, 12px);
            color: #555;
        }

        .cv-degree {
            font-size: clamp(10px, 1.5vw, 12px);
            font-style: italic;
            margin-left: 0.5rem;
            margin-bottom: 0.2rem;
        }

        .cv-degree-details {
            font-size: clamp(10px, 1.5vw, 12px);
            margin-left: 1rem;
            color: #555;
        }

        /* Skills with bullets */
        .cv-skills {
            font-size: clamp(10px, 1.5vw, 12px);
            margin-left: 1rem;
        }

        .cv-skills ul {
            padding-left: 1rem;
            margin-top: 0.2rem;
        }

        /* Referees */
        .cv-referees-item {
            margin-bottom: 0.8rem;
        }

        .cv-referee-name {
            font-weight: bold;
            font-size: clamp(11px, 1.8vw, 12px);
            margin-bottom: 0.1rem;
        }

        .cv-referee-position {
            font-size: clamp(10px, 1.5vw, 12px);
            font-style: italic;
            margin-bottom: 0.1rem;
        }

        .cv-referee-company {
            font-size: clamp(10px, 1.5vw, 12px);
            margin-bottom: 0.1rem;
        }

        .cv-referee-contact {
            font-size: clamp(10px, 1.5vw, 12px);
            color: #555;
        }

        /* Controls */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin-top: 1.2rem;
            padding-top: 1.2rem;
            border-top: 1px solid #ddd;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 1.5rem 0;
            color: #666;
            font-size: clamp(0.8rem, 1.5vw, 0.9rem);
            border-top: 1px solid #ddd;
            margin-top: 2rem;
        }

        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .app-container {
                gap: 1rem;
            }
            
            .form-section, .preview-section {
                padding: 1rem;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 1rem 0;
                margin-bottom: 1rem;
            }
            
            .app-container {
                flex-direction: column;
            }
            
            .personal-details-grid {
                grid-template-columns: 1fr;
            }
            
            .preview-container {
                padding: 1rem;
                min-height: 400px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .form-section, .preview-section {
                padding: 0.8rem;
            }
            
            .section-title {
                font-size: 1rem;
            }
            
            .cv-name {
                font-size: 16px;
            }
            
            .cv-title {
                font-size: 13px;
            }
            
            .cv-contact {
                font-size: 11px;
            }
        }

        /* Print styles */
        @media print {
            body {
                background: white;
            }
            
            .form-section, .controls, header, .footer {
                display: none;
            }
            
            .preview-section {
                box-shadow: none;
                border: none;
                width: 100%;
                max-width: 100%;
            }
            
            .preview-container {
                border: none;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Professional CV Generator</h1>
            <p>Create professional resumes instantly. Fill your details and generate a polished CV ready for job applications.</p>
        </div>
    </header>

    <div class="container">
        <div class="app-container">
            <!-- Form Section -->
            <div class="form-section">
                <h2 class="section-title">CV Information</h2>
                
                <div class="form-group">
                    <label for="fullName">Full Name *</label>
                    <input type="text" id="fullName" class="form-control" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-group">
                    <label for="jobTitle">Professional Title *</label>
                    <input type="text" id="jobTitle" class="form-control" placeholder="e.g., Software Developer, Marketing Manager" required>
                </div>
                
                <h3 class="section-title">Personal Details</h3>
                <div class="personal-details-grid">
                    <div class="form-group">
                        <label for="email">Email Address *</label>
                        <input type="email" id="email" class="form-control" placeholder="your.email@example.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">Phone Number *</label>
                        <input type="tel" id="phone" class="form-control" placeholder="+254......." required>
                    </div>
                    
                    <div class="form-group">
                        <label for="location">Location *</label>
                        <input type="text" id="location" class="form-control" placeholder="City, Country" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="professionalSummary">Professional Summary *</label>
                    <textarea id="professionalSummary" class="form-control" placeholder="Briefly describe your professional background, skills, and career objectives..." rows="3" required></textarea>
                </div>
                
                <h3 class="section-title">Work Experience</h3>
                <div id="experienceContainer">
                    <div class="section-item">
                        <div class="form-group">
                            <label>Organization *</label>
                            <input type="text" class="form-control exp-org" placeholder="Company/Organization Name" required>
                        </div>
                        <div class="form-group">
                            <label>Period *</label>
                            <input type="text" class="form-control exp-period" placeholder="e.g., Jan 2020 – Present" required>
                        </div>
                        <div class="form-group">
                            <label>Job Title *</label>
                            <input type="text" class="form-control exp-role" placeholder="Your position/role" required>
                        </div>
                        <div class="form-group">
                            <label>Roles & Responsibilities * (one per line, start with "- ")</label>
                            <textarea class="form-control exp-desc" rows="4" placeholder="- Responsibility 1&#10;- Responsibility 2&#10;- Responsibility 3" required></textarea>
                        </div>
                        <button type="button" class="remove-btn remove-exp">Remove Experience</button>
                    </div>
                </div>
                <button type="button" class="add-btn" id="addExperience">+ Add Another Experience</button>
                
                <h3 class="section-title">Education</h3>
                <div id="educationContainer">
                    <div class="section-item">
                        <div class="form-group">
                            <label>Institution *</label>
                            <input type="text" class="form-control edu-school" placeholder="University/College Name" required>
                        </div>
                        <div class="form-group">
                            <label>Period *</label>
                            <input type="text" class="form-control edu-period" placeholder="e.g., 2018 – 2022" required>
                        </div>
                        <div class="form-group">
                            <label>Degree/Certificate *</label>
                            <input type="text" class="form-control edu-degree" placeholder="e.g., Bachelor of Science in Computer Science" required>
                        </div>
                        <div class="form-group">
                            <label>Details (optional)</label>
                            <textarea class="form-control edu-desc" placeholder="Relevant coursework, achievements, or additional information" rows="2"></textarea>
                        </div>
                        <button type="button" class="remove-btn remove-edu">Remove Education</button>
                    </div>
                </div>
                <button type="button" class="add-btn" id="addEducation">+ Add Another Education</button>
                
                <h3 class="section-title">Additional Skills</h3>
                <div class="form-group">
                    <label>Add Skills (separate with commas) *</label>
                    <div class="skills-input">
                        <input type="text" id="skillInput" class="form-control" placeholder="e.g., Project Management, Python, Data Analysis">
                        <button type="button" class="btn" id="addSkillBtn">Add</button>
                    </div>
                    <small style="color: #666; font-size: 0.8rem;">Click on a skill to remove it</small>
                </div>
                <div id="skillsContainer" class="skills-container">
                    <!-- Skills will be added here -->
                </div>
                
                <h3 class="section-title">Referees</h3>
                <div id="refereesContainer">
                    <div class="section-item">
                        <div class="form-group">
                            <label>Referee Name (optional)</label>
                            <input type="text" class="form-control referee-name" placeholder="Full Name">
                        </div>
                        <div class="form-group">
                            <label>Company/Organization (optional)</label>
                            <input type="text" class="form-control referee-company" placeholder="Company Name">
                        </div>
                        <div class="form-group">
                            <label>Position/Title (optional)</label>
                            <input type="text" class="form-control referee-position" placeholder="Position/Title">
                        </div>
                        <div class="form-group">
                            <label>Contact Information (optional)</label>
                            <input type="text" class="form-control referee-contact" placeholder="Phone: XXX, Email: XXX">
                        </div>
                        <button type="button" class="remove-btn remove-referee">Remove Referee</button>
                    </div>
                </div>
                <button type="button" class="add-btn" id="addReferee">+ Add Another Referee</button>
            </div>
            
            <!-- Preview Section -->
            <div class="preview-section">
                <h2 class="section-title">CV Preview</h2>
                <div class="preview-container">
                    <div id="cvPreview" class="cv-preview">
                        <!-- Preview will be generated here -->
                        <div style="text-align: center; color: #777; padding: 3rem 1rem;">
                            <p style="font-size: 1.1rem; margin-bottom: 1rem;">Your CV preview will appear here</p>
                            <p>Fill in the form on the left to see a live preview of your professional CV.</p>
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn" id="resetForm">Clear Form</button>
                    <button class="btn btn-success" id="downloadCv">Download CV</button>
                </div>
                
                <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 5px; border-left: 4px solid #3498db;">
                    <p style="font-size: 0.9rem; color: #555; line-height: 1.5;">
                        <strong>Note:</strong> CV generation requires a one-time payment of KES 50. 
                        Click the "Download CV" button to proceed to secure payment.
                    </p>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Professional CV Generator &copy; 2024 | Secure CV creation with professional formatting</p>
            <p style="margin-top: 0.5rem; font-size: 0.8rem;">All payments processed securely via Lipa Na</p>
        </div>
    </div>

    <script>
        // Initialize with empty skills array
        let skills = [];
        
        // Initialize skills display
        function renderSkills() {
            const container = document.getElementById('skillsContainer');
            container.innerHTML = '';
            skills.forEach(skill => {
                const tag = document.createElement('div');
                tag.className = 'skill-tag';
                tag.innerHTML = `${skill} <span style="margin-left: 8px; cursor: pointer; color: #e74c3c; font-weight: bold;" onclick="removeSkill('${skill}')">×</span>`;
                container.appendChild(tag);
            });
        }
        
        // Remove a skill
        function removeSkill(skill) {
            skills = skills.filter(s => s !== skill);
            renderSkills();
            updatePreview();
        }
        
        // Add a skill
        document.getElementById('addSkillBtn').addEventListener('click', function() {
            const input = document.getElementById('skillInput');
            const newSkills = input.value.split(',').map(s => s.trim()).filter(s => s !== '');
            if (newSkills.length > 0) {
                skills = [...skills, ...newSkills];
                input.value = '';
                renderSkills();
                updatePreview();
            }
        });
        
        // Allow Enter key to add skills
        document.getElementById('skillInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('addSkillBtn').click();
            }
        });
        
        // Add experience entry
        document.getElementById('addExperience').addEventListener('click', function() {
            const container = document.getElementById('experienceContainer');
            const newItem = document.createElement('div');
            newItem.className = 'section-item';
            newItem.innerHTML = `
                <div class="form-group">
                    <label>Organization *</label>
                    <input type="text" class="form-control exp-org" placeholder="Company/Organization Name" required>
                </div>
                <div class="form-group">
                    <label>Period *</label>
                    <input type="text" class="form-control exp-period" placeholder="e.g., Jan 2020 – Present" required>
                </div>
                <div class="form-group">
                    <label>Job Title *</label>
                    <input type="text" class="form-control exp-role" placeholder="Your position/role" required>
                </div>
                <div class="form-group">
                    <label>Roles & Responsibilities * (one per line, start with "- ")</label>
                    <textarea class="form-control exp-desc" rows="4" placeholder="- Responsibility 1&#10;- Responsibility 2" required></textarea>
                </div>
                <button type="button" class="remove-btn remove-exp">Remove Experience</button>
            `;
            container.appendChild(newItem);
            
            // Add event listener to remove button
            newItem.querySelector('.remove-exp').addEventListener('click', function() {
                if (container.children.length > 1) {
                    container.removeChild(newItem);
                    updatePreview();
                } else {
                    alert('You must have at least one work experience entry.');
                }
            });
            
            // Add input listeners
            const inputs = newItem.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', updatePreview);
            });
            
            updatePreview();
        });
        
        // Add education entry
        document.getElementById('addEducation').addEventListener('click', function() {
            const container = document.getElementById('educationContainer');
            const newItem = document.createElement('div');
            newItem.className = 'section-item';
            newItem.innerHTML = `
                <div class="form-group">
                    <label>Institution *</label>
                    <input type="text" class="form-control edu-school" placeholder="University/College Name" required>
                </div>
                <div class="form-group">
                    <label>Period *</label>
                    <input type="text" class="form-control edu-period" placeholder="e.g., 2018 – 2022" required>
                </div>
                <div class="form-group">
                    <label>Degree/Certificate *</label>
                    <input type="text" class="form-control edu-degree" placeholder="e.g., Bachelor of Science" required>
                </div>
                <div class="form-group">
                    <label>Details (optional)</label>
                    <textarea class="form-control edu-desc" placeholder="Relevant coursework or achievements" rows="2"></textarea>
                </div>
                <button type="button" class="remove-btn remove-edu">Remove Education</button>
            `;
            container.appendChild(newItem);
            
            // Add event listener to remove button
            newItem.querySelector('.remove-edu').addEventListener('click', function() {
                if (container.children.length > 1) {
                    container.removeChild(newItem);
                    updatePreview();
                } else {
                    alert('You must have at least one education entry.');
                }
            });
            
            // Add input listeners
            const inputs = newItem.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', updatePreview);
            });
            
            updatePreview();
        });
        
        // Add referee entry
        document.getElementById('addReferee').addEventListener('click', function() {
            const container = document.getElementById('refereesContainer');
            const newItem = document.createElement('div');
            newItem.className = 'section-item';
            newItem.innerHTML = `
                <div class="form-group">
                    <label>Referee Name (optional)</label>
                    <input type="text" class="form-control referee-name" placeholder="Full Name">
                </div>
                <div class="form-group">
                    <label>Company/Organization (optional)</label>
                    <input type="text" class="form-control referee-company" placeholder="Company Name">
                </div>
                <div class="form-group">
                    <label>Position/Title (optional)</label>
                    <input type="text" class="form-control referee-position" placeholder="Position/Title">
                </div>
                <div class="form-group">
                    <label>Contact Information (optional)</label>
                    <input type="text" class="form-control referee-contact" placeholder="Phone: XXX, Email: XXX">
                </div>
                <button type="button" class="remove-btn remove-referee">Remove Referee</button>
            `;
            container.appendChild(newItem);
            
            // Add event listener to remove button
            newItem.querySelector('.remove-referee').addEventListener('click', function() {
                if (container.children.length > 1) {
                    container.removeChild(newItem);
                    updatePreview();
                }
            });
            
            // Add input listeners
            const inputs = newItem.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', updatePreview);
            });
            
            updatePreview();
        });
        
        // Update CV preview
        function updatePreview() {
            // Get form values
            const fullName = document.getElementById('fullName').value || 'Your Name';
            const jobTitle = document.getElementById('jobTitle').value || 'Professional Title';
            const email = document.getElementById('email').value || 'your.email@example.com';
            const phone = document.getElementById('phone').value || '+1234567890';
            const location = document.getElementById('location').value || 'City, Country';
            const summary = document.getElementById('professionalSummary').value || 'Professional summary goes here. Briefly describe your background, skills, and career objectives.';
            
            // Build contact info from separate fields
            const contactInfo = `${email} | ${phone} | ${location}`;
            
            // Get experiences
            const experienceItems = document.querySelectorAll('#experienceContainer .section-item');
            const experiences = [];
            experienceItems.forEach(item => {
                experiences.push({
                    org: item.querySelector('.exp-org').value,
                    period: item.querySelector('.exp-period').value,
                    role: item.querySelector('.exp-role').value,
                    desc: item.querySelector('.exp-desc').value
                });
            });
            
            // Get education
            const educationItems = document.querySelectorAll('#educationContainer .section-item');
            const educations = [];
            educationItems.forEach(item => {
                educations.push({
                    school: item.querySelector('.edu-school').value,
                    period: item.querySelector('.edu-period').value,
                    degree: item.querySelector('.edu-degree').value,
                    details: item.querySelector('.edu-desc').value
                });
            });
            
            // Get referees
            const refereeItems = document.querySelectorAll('#refereesContainer .section-item');
            const referees = [];
            refereeItems.forEach(item => {
                referees.push({
                    name: item.querySelector('.referee-name').value,
                    company: item.querySelector('.referee-company').value,
                    position: item.querySelector('.referee-position').value,
                    contact: item.querySelector('.referee-contact').value
                });
            });
            
            // Build preview HTML
            let previewHTML = `
                <div class="cv-header">
                    <div class="cv-name">${fullName}</div>
                    <div class="cv-title">${jobTitle}</div>
                    <div class="cv-contact">${contactInfo}</div>
                </div>
                
                <div class="cv-section">
                    <div class="cv-section-title">PROFESSIONAL SUMMARY</div>
                    <div>${summary.replace(/\n/g, '<br>')}</div>
                </div>
            `;
            
            // Add Work Experience if any
            if (experiences.some(exp => exp.org || exp.period || exp.role || exp.desc)) {
                previewHTML += `
                    <div class="cv-section">
                        <div class="cv-section-title">WORK EXPERIENCE</div>
                `;
                
                experiences.forEach(exp => {
                    if (exp.org || exp.period || exp.role || exp.desc) {
                        previewHTML += `
                            <div class="cv-experience-item">
                                <div class="cv-experience-header">
                                    <div class="cv-organization">${exp.org || ''}</div>
                                    <div class="cv-period">${exp.period || ''}</div>
                                </div>
                        `;
                        
                        if (exp.role) {
                            previewHTML += `<div class="cv-role">${exp.role}</div>`;
                        }
                        
                        if (exp.desc) {
                            previewHTML += `<div class="cv-roles-title">Roles & Responsibilities</div>`;
                            previewHTML += `
                                <div class="cv-responsibilities">
                                    <ul>
                                        ${exp.desc.split('\n').filter(line => line.trim()).map(line => 
                                            `<li>${line.trim().replace(/^- /, '')}</li>`
                                        ).join('')}
                                    </ul>
                                </div>
                            `;
                        }
                        
                        previewHTML += `</div>`;
                    }
                });
                
                previewHTML += `</div>`;
            }
            
            // Add Education if any
            if (educations.some(edu => edu.school || edu.period || edu.degree || edu.details)) {
                previewHTML += `
                    <div class="cv-section">
                        <div class="cv-section-title">EDUCATION</div>
                `;
                
                educations.forEach(edu => {
                    if (edu.school || edu.period || edu.degree || edu.details) {
                        previewHTML += `
                            <div class="cv-education-item">
                                <div class="cv-education-header">
                                    <div class="cv-institution">${edu.school || ''}</div>
                                    <div class="cv-education-period">${edu.period || ''}</div>
                                </div>
                        `;
                        
                        if (edu.degree) {
                            previewHTML += `<div class="cv-degree">${edu.degree}</div>`;
                        }
                        
                        if (edu.details) {
                            previewHTML += `<div class="cv-degree-details">${edu.details.replace(/\n/g, '<br>')}</div>`;
                        }
                        
                        previewHTML += `</div>`;
                    }
                });
                
                previewHTML += `</div>`;
            }
            
            // Add Skills if any
            if (skills.length > 0) {
                previewHTML += `
                    <div class="cv-section">
                        <div class="cv-section-title">ADDITIONAL SKILLS</div>
                        <div class="cv-skills">
                            <ul>
                                ${skills.map(skill => `<li>${skill}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            // Add Referees if any
            if (referees.some(ref => ref.name || ref.company || ref.position || ref.contact)) {
                previewHTML += `
                    <div class="cv-section">
                        <div class="cv-section-title">REFEREES</div>
                `;
                
                referees.forEach(ref => {
                    if (ref.name || ref.company || ref.position || ref.contact) {
                        previewHTML += `
                            <div class="cv-referees-item">
                                ${ref.name ? `<div class="cv-referee-name">${ref.name}</div>` : ''}
                                ${ref.position ? `<div class="cv-referee-position">${ref.position}</div>` : ''}
                                ${ref.company ? `<div class="cv-referee-company">${ref.company}</div>` : ''}
                                ${ref.contact ? `<div class="cv-referee-contact">${ref.contact}</div>` : ''}
                            </div>
                        `;
                    }
                });
                
                previewHTML += `</div>`;
            }
            
            document.getElementById('cvPreview').innerHTML = previewHTML;
        }
        
        // Generate PDF function
        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Set Times New Roman font
            doc.setFont("times", "normal");
            
            // Get form values
            const fullName = document.getElementById('fullName').value || 'Your Name';
            const jobTitle = document.getElementById('jobTitle').value || 'Professional Title';
            const email = document.getElementById('email').value || 'email@example.com';
            const phone = document.getElementById('phone').value || '+1234567890';
            const location = document.getElementById('location').value || 'City, Country';
            const summary = document.getElementById('professionalSummary').value || 'Professional summary';
            
            // Build contact info from separate fields
            const contactInfo = `${email} | ${phone} | ${location}`;
            
            // Set initial position
            let yPos = 25;
            
            // Name - Large centered text
            doc.setFontSize(18);
            doc.setFont("times", "bold");
            doc.text(fullName, 105, yPos, { align: 'center' });
            yPos += 8;
            
            // Job Title - smaller centered text
            doc.setFontSize(14);
            doc.setFont("times", "bold");
            doc.text(jobTitle, 105, yPos, { align: 'center' });
            yPos += 6;
            
            // Contact Info - small centered text
            doc.setFontSize(12);
            doc.setFont("times", "normal");
            doc.text(contactInfo, 105, yPos, { align: 'center' });
            yPos += 5;
            
            // Draw underline under main header section
            doc.setDrawColor(0, 0, 0);
            doc.setLineWidth(0.5);
            doc.line(20, yPos, 190, yPos);
            yPos += 8;
            
            // Professional Summary section
            doc.setFontSize(14);
            doc.setFont("times", "bold");
            doc.text("PROFESSIONAL SUMMARY", 20, yPos);
            doc.setLineWidth(0.3);
            doc.line(20, yPos + 1, 190, yPos + 1);
            yPos += 8;
            
            doc.setFontSize(12);
            doc.setFont("times", "normal");
            const summaryLines = doc.splitTextToSize(summary, 170);
            doc.text(summaryLines, 20, yPos);
            yPos += (summaryLines.length * 6) + 8;
            
            // Work Experience section
            doc.setFontSize(14);
            doc.setFont("times", "bold");
            doc.text("WORK EXPERIENCE", 20, yPos);
            doc.line(20, yPos + 1, 190, yPos + 1);
            yPos += 8;
            
            const experienceItems = document.querySelectorAll('#experienceContainer .section-item');
            
            experienceItems.forEach((item, index) => {
                const org = item.querySelector('.exp-org').value;
                const period = item.querySelector('.exp-period').value;
                const role = item.querySelector('.exp-role').value;
                const desc = item.querySelector('.exp-desc').value;
                
                if (org || period || role || desc) {
                    if (yPos > 260) {
                        doc.addPage();
                        yPos = 25;
                        doc.setFontSize(14);
                        doc.setFont("times", "bold");
                        doc.text("WORK EXPERIENCE (continued)", 20, yPos);
                        doc.line(20, yPos + 1, 190, yPos + 1);
                        yPos += 8;
                    }
                    
                    // Organization on left, period on right
                    doc.setFontSize(12);
                    doc.setFont("times", "bold");
                    doc.text(org || '', 20, yPos);
                    
                    doc.setFontSize(12);
                    doc.setFont("times", "normal");
                    doc.text(period || '', 190, yPos, { align: 'right' });
                    yPos += 6;
                    
                    // Role if exists
                    if (role) {
                        doc.setFontSize(12);
                        doc.setFont("times", "italic");
                        doc.text(role, 20, yPos);
                        yPos += 6;
                    }
                    
                    // Roles & Responsibilities title
                    doc.setFontSize(12);
                    doc.setFont("times", "bold");
                    doc.text("Roles & Responsibilities", 20, yPos);
                    const titleWidth = doc.getTextWidth("Roles & Responsibilities");
                    doc.setDrawColor(0, 0, 0);
                    doc.setLineWidth(0.2);
                    doc.line(20, yPos + 1, 20 + titleWidth, yPos + 1);
                    yPos += 6;
                    
                    // Responsibilities list
                    if (desc) {
                        doc.setFontSize(12);
                        doc.setFont("times", "normal");
                        const responsibilities = desc.split('\n').filter(line => line.trim());
                        
                        responsibilities.forEach(resp => {
                            if (yPos > 270) {
                                doc.addPage();
                                yPos = 25;
                                doc.setFontSize(12);
                                doc.setFont("times", "bold");
                                doc.text(org || '', 20, yPos);
                                doc.setFontSize(12);
                                doc.setFont("times", "normal");
                                doc.text(period || '', 190, yPos, { align: 'right' });
                                yPos += 12;
                                doc.setFontSize(12);
                                doc.setFont("times", "bold");
                                doc.text("Roles & Responsibilities (continued)", 20, yPos);
                                yPos += 6;
                            }
                            
                            const cleanResp = resp.replace(/^- /, '').trim();
                            const respLines = doc.splitTextToSize(`• ${cleanResp}`, 165);
                            respLines.forEach((line, lineIndex) => {
                                if (yPos > 270) {
                                    doc.addPage();
                                    yPos = 25;
                                    doc.setFontSize(12);
                                    doc.setFont("times", "bold");
                                    doc.text(org || '', 20, yPos);
                                    doc.setFontSize(12);
                                    doc.setFont("times", "normal");
                                    doc.text(period || '', 190, yPos, { align: 'right' });
                                    yPos += 12;
                                    doc.setFontSize(12);
                                    doc.setFont("times", "bold");
                                    doc.text("Roles & Responsibilities (continued)", 20, yPos);
                                    yPos += 6;
                                }
                                doc.text(line, 25, yPos);
                                yPos += 6;
                            });
                        });
                        yPos += 4;
                    } else {
                        yPos += 4;
                    }
                }
            });
            
            // Education section
            if (yPos > 240) {
                doc.addPage();
                yPos = 25;
            }
            
            doc.setFontSize(14);
            doc.setFont("times", "bold");
            doc.text("EDUCATION", 20, yPos);
            doc.line(20, yPos + 1, 190, yPos + 1);
            yPos += 8;
            
            const educationItems = document.querySelectorAll('#educationContainer .section-item');
            
            educationItems.forEach(item => {
                const school = item.querySelector('.edu-school').value;
                const period = item.querySelector('.edu-period').value;
                const degree = item.querySelector('.edu-degree').value;
                const details = item.querySelector('.edu-desc').value;
                
                if (school || period || degree || details) {
                    if (yPos > 260) {
                        doc.addPage();
                        yPos = 25;
                        doc.setFontSize(14);
                        doc.setFont("times", "bold");
                        doc.text("EDUCATION (continued)", 20, yPos);
                        doc.line(20, yPos + 1, 190, yPos + 1);
                        yPos += 8;
                    }
                    
                    // Institution on left, period on right
                    doc.setFontSize(12);
                    doc.setFont("times", "bold");
                    doc.text(school || '', 20, yPos);
                    
                    doc.setFontSize(12);
                    doc.setFont("times", "normal");
                    doc.text(period || '', 190, yPos, { align: 'right' });
                    yPos += 6;
                    
                    // Degree (italic)
                    if (degree) {
                        doc.setFontSize(12);
                        doc.setFont("times", "italic");
                        doc.text(degree, 25, yPos);
                        yPos += 6;
                    }
                    
                    // Details
                    if (details) {
                        doc.setFontSize(12);
                        doc.setFont("times", "normal");
                        const detailLines = doc.splitTextToSize(details, 160);
                        detailLines.forEach(line => {
                            if (yPos > 270) {
                                doc.addPage();
                                yPos = 25;
                                doc.setFontSize(12);
                                doc.setFont("times", "bold");
                                doc.text(school || '', 20, yPos);
                                doc.setFontSize(12);
                                doc.setFont("times", "normal");
                                doc.text(period || '', 190, yPos, { align: 'right' });
                                yPos += 6;
                                doc.setFontSize(12);
                                doc.setFont("times", "italic");
                                doc.text(degree || '', 25, yPos);
                                yPos += 6;
                            }
                            doc.text(line, 30, yPos);
                            yPos += 6;
                        });
                        yPos += 3;
                    } else {
                        yPos += 3;
                    }
                }
            });
            
            // Additional Skills section
            if (yPos > 250) {
                doc.addPage();
                yPos = 25;
                doc.setFontSize(14);
                doc.setFont("times", "bold");
                doc.text("ADDITIONAL SKILLS", 20, yPos);
                doc.line(20, yPos + 1, 190, yPos + 1);
                yPos += 8;
            } else {
                doc.setFontSize(14);
                doc.setFont("times", "bold");
                doc.text("ADDITIONAL SKILLS", 20, yPos);
                doc.line(20, yPos + 1, 190, yPos + 1);
                yPos += 8;
            }
            
            doc.setFontSize(12);
            doc.setFont("times", "normal");
            
            // Add bullet points for skills
            skills.forEach(skill => {
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 25;
                    doc.setFontSize(14);
                    doc.setFont("times", "bold");
                    doc.text("ADDITIONAL SKILLS (continued)", 20, yPos);
                    doc.line(20, yPos + 1, 190, yPos + 1);
                    yPos += 8;
                }
                doc.text(`• ${skill}`, 25, yPos);
                yPos += 6;
            });
            
            // Referees section
            const refereeItems = document.querySelectorAll('#refereesContainer .section-item');
            const hasReferees = Array.from(refereeItems).some(ref => {
                const name = ref.querySelector('.referee-name').value;
                const company = ref.querySelector('.referee-company').value;
                const position = ref.querySelector('.referee-position').value;
                const contact = ref.querySelector('.referee-contact').value;
                return name || company || position || contact;
            });
            
            if (hasReferees) {
                if (yPos > 240) {
                    doc.addPage();
                    yPos = 25;
                }
                
                doc.setFontSize(14);
                doc.setFont("times", "bold");
                doc.text("REFEREES", 20, yPos);
                doc.line(20, yPos + 1, 190, yPos + 1);
                yPos += 8;
                
                refereeItems.forEach(ref => {
                    const name = ref.querySelector('.referee-name').value;
                    const company = ref.querySelector('.referee-company').value;
                    const position = ref.querySelector('.referee-position').value;
                    const contact = ref.querySelector('.referee-contact').value;
                    
                    if (name || company || position || contact) {
                        if (yPos > 260) {
                            doc.addPage();
                            yPos = 25;
                            doc.setFontSize(14);
                            doc.setFont("times", "bold");
                            doc.text("REFEREES (continued)", 20, yPos);
                            doc.line(20, yPos + 1, 190, yPos + 1);
                            yPos += 8;
                        }
                        
                        // Referee Name
                        if (name) {
                            doc.setFontSize(12);
                            doc.setFont("times", "bold");
                            doc.text(name || '', 20, yPos);
                            yPos += 6;
                        }
                        
                        // Position
                        if (position) {
                            doc.setFontSize(12);
                            doc.setFont("times", "italic");
                            doc.text(position || '', 20, yPos);
                            yPos += 6;
                        }
                        
                        // Company
                        if (company) {
                            doc.setFontSize(12);
                            doc.setFont("times", "normal");
                            doc.text(company || '', 20, yPos);
                            yPos += 6;
                        }
                        
                        // Contact
                        if (contact) {
                            doc.setFontSize(12);
                            doc.text(contact || '', 20, yPos);
                            yPos += 6;
                        }
                        
                        // Add spacing between referees
                        yPos += 6;
                    }
                });
            }
            
            // Remove footer with generation info
            // doc.setFontSize(8);
            // doc.setTextColor(150, 150, 150);
            // doc.text("Generated with Professional CV Generator", 105, 285, { align: 'center' });
            // doc.text(new Date().toLocaleDateString(), 190, 285, { align: 'right' });
            
            // Save PDF
            doc.save(`${fullName.replace(/\s+/g, '_')}_Professional_CV.pdf`);
        }
        
        // Reset form
        document.getElementById('resetForm').addEventListener('click', function() {
            if (confirm('Are you sure you want to clear all form data?')) {
                document.getElementById('fullName').value = '';
                document.getElementById('jobTitle').value = '';
                document.getElementById('email').value = '';
                document.getElementById('phone').value = '';
                document.getElementById('location').value = '';
                document.getElementById('professionalSummary').value = '';
                
                // Clear experiences (keep one)
                const expContainer = document.getElementById('experienceContainer');
                while (expContainer.children.length > 1) {
                    expContainer.removeChild(expContainer.lastChild);
                }
                const firstExp = expContainer.querySelector('.section-item');
                if (firstExp) {
                    firstExp.querySelector('.exp-org').value = '';
                    firstExp.querySelector('.exp-period').value = '';
                    firstExp.querySelector('.exp-role').value = '';
                    firstExp.querySelector('.exp-desc').value = '';
                }
                
                // Clear education (keep one)
                const eduContainer = document.getElementById('educationContainer');
                while (eduContainer.children.length > 1) {
                    eduContainer.removeChild(eduContainer.lastChild);
                }
                const firstEdu = eduContainer.querySelector('.section-item');
                if (firstEdu) {
                    firstEdu.querySelector('.edu-school').value = '';
                    firstEdu.querySelector('.edu-period').value = '';
                    firstEdu.querySelector('.edu-degree').value = '';
                    firstEdu.querySelector('.edu-desc').value = '';
                }
                
                // Clear skills
                skills = [];
                renderSkills();
                
                // Clear referees (keep one)
                const refContainer = document.getElementById('refereesContainer');
                while (refContainer.children.length > 1) {
                    refContainer.removeChild(refContainer.lastChild);
                }
                const firstRef = refContainer.querySelector('.section-item');
                if (firstRef) {
                    firstRef.querySelector('.referee-name').value = '';
                    firstRef.querySelector('.referee-company').value = '';
                    firstRef.querySelector('.referee-position').value = '';
                    firstRef.querySelector('.referee-contact').value = '';
                }
                
                updatePreview();
            }
        });
        
        // Ensure the jsPDF library is loaded
        if (!window.jspdf) {
            console.error("jsPDF library is not loaded. Ensure the script tag is correct.");
        }

        const webhookUrl = "https://eoueffnaompn4qj.m.pipedream.net";
        const webhookSecret = "45ddff682331b8fc97e5caf6621aa635610710ae95b4b3be47553a716be26d5e";
        const secretKey = "lip_sk_live_5834e14259d334293932126e703a8ca9be4f7a4699aaa0662d75a2cc2d3770a0";

        // Function to validate phone number
        function validatePhoneNumber(phone) {
            return /^254\d{9}$/.test(phone);
        }

        // Enhanced initiatePayment function with debugging logs
        async function initiatePayment(phone) {
            try {
                console.log("Initiating payment with phone:", phone);

                const response = await fetch(webhookUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${secretKey}`
                    },
                    body: JSON.stringify({
                        phone: phone,
                        amount: 80,
                        currency: "KES",
                        description: "CV Payment"
                    })
                });

                console.log("Payment initiation response status:", response.status);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error("Payment initiation failed with response:", errorText);
                    throw new Error("Payment initiation failed.");
                }

                const data = await response.json();
                console.log("Payment initiation successful. Response data:", data);
                return data;
            } catch (error) {
                console.error("Error initiating payment:", error);
                alert("Failed to initiate payment. Please try again.");
                return null;
            }
        }

        // Function to verify payment
        async function verifyPayment(paymentId) {
            try {
                const response = await fetch(`${webhookUrl}/${paymentId}`, {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${webhookSecret}`
                    }
                });

                if (!response.ok) {
                    throw new Error("Payment verification failed.");
                }

                const data = await response.json();
                return data.status === "success";
            } catch (error) {
                console.error("Error verifying payment:", error);
                alert("Failed to verify payment. Please try again.");
                return false;
            }
        }

        // Event listener for the Download CV button
        document.getElementById("downloadCv").addEventListener("click", async function () {
            const phone = prompt("Enter your phone number (starting with 254):");

            if (!validatePhoneNumber(phone)) {
                alert("Invalid phone number. Please enter a valid number starting with 254.");
                return;
            }

            const paymentResponse = await initiatePayment(phone);

            if (paymentResponse && paymentResponse.paymentId) {
                alert("Payment request sent. Please complete the payment on your phone.");

                // Poll for payment verification
                const isPaymentSuccessful = await verifyPayment(paymentResponse.paymentId);

                if (isPaymentSuccessful) {
                    alert("Payment successful! Your CV will now download.");
                    generatePDF();
                } else {
                    alert("Payment not verified. Please try again.");
                }
            }
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderSkills();
            updatePreview();
            
            // Add input listeners to existing form elements
            document.querySelectorAll('.form-control').forEach(input => {
                input.addEventListener('input', updatePreview);
            });
            
            // Add event listeners to existing remove buttons
            document.querySelectorAll('.remove-exp, .remove-edu, .remove-referee').forEach(btn => {
                btn.addEventListener('click', function() {
                    const item = this.closest('.section-item');
                    const container = item.parentNode;
                    if (container.children.length > 1) {
                        container.removeChild(item);
                        updatePreview();
                    }
                });
            });
            
            // Focus on first field
            document.getElementById('fullName').focus();
        });
    </script>
</body>
</html>